(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{15845:function(e,n,r){e.exports=r(47434)().Promise},98922:function(e){"use strict";var n="@@any-promise/REGISTRATION",r=null;e.exports=function(e,t){return function(a,i){a=a||null;var s=!1!==(i=i||{}).global;if(null===r&&s&&(r=e[n]||null),null!==r&&null!==a&&r.implementation!==a)throw new Error('any-promise already defined as "'+r.implementation+'".  You can only register an implementation before the first  call to require("any-promise") and an implementation cannot be changed');return null===r&&(r=null!==a&&"undefined"!==typeof i.Promise?{Promise:i.Promise,implementation:a}:t(a),s&&(e[n]=r)),r}}},47434:function(e,n,r){"use strict";e.exports=r(98922)(window,(function(){if("undefined"===typeof window.Promise)throw new Error("any-promise browser requires a polyfill or explicit registration e.g: require('any-promise/register/bluebird')");return{Promise:window.Promise,implementation:"window.Promise"}}))},94184:function(e,n){var r;!function(){"use strict";var t={}.hasOwnProperty;function a(){for(var e=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var i=typeof r;if("string"===i||"number"===i)e.push(r);else if(Array.isArray(r)&&r.length){var s=a.apply(null,r);s&&e.push(s)}else if("object"===i)for(var o in r)t.call(r,o)&&r[o]&&e.push(o)}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(r=function(){return a}.apply(n,[]))||(e.exports=r)}()},13192:function(e){"use strict";e.exports=function(e){var n,r={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(n in e)e.hasOwnProperty(n)&&(r[n]=n);return r}},91089:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return T}});var t=r(15861),a=r(87757),i=r.n(a);const s=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"anonymous",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"registerQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"Me",kind:"LinkedField",name:"me",plural:!1,selections:[e,n,r,t],storageKey:null},{args:null,kind:"FragmentSpread",name:"RegisterPage_viewer"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"registerQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"Me",kind:"LinkedField",name:"me",plural:!1,selections:[e,n,r,t,{alias:null,args:[{kind:"Literal",name:"first",value:1}],concreteType:"CodeshareConnection",kind:"LinkedField",name:"codesharesCreated",plural:!1,selections:[{alias:null,args:null,concreteType:"CodeshareConnectionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Codeshare",kind:"LinkedField",name:"node",plural:!1,selections:[e],storageKey:null}],storageKey:null}],storageKey:"codesharesCreated(first:1)"}],storageKey:null}],storageKey:null}]},params:{cacheID:"e3cd265ebc69c1b2bb00c905664bc6f2",id:null,metadata:{},name:"registerQuery",operationKind:"query",text:"query registerQuery {\n  viewer {\n    me {\n      id\n      anonymous\n      email\n      name\n    }\n    ...RegisterPage_viewer\n  }\n}\n\nfragment RegisterForm_me on Me {\n  id\n}\n\nfragment RegisterPage_viewer on Viewer {\n  me {\n    anonymous\n    codesharesCreated(first: 1) {\n      edges {\n        node {\n          id\n        }\n      }\n    }\n    ...RegisterForm_me\n    id\n  }\n}\n"}}}();s.hash="603abc2c013d6d06e57026d37f39354e";var o=s,l=r(67912),u=r(38631),c=r(50559);r(4723),r(88674);const d={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"RegisterPage_viewer",selections:[{alias:null,args:null,concreteType:"Me",kind:"LinkedField",name:"me",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"anonymous",storageKey:null},{alias:null,args:[{kind:"Literal",name:"first",value:1}],concreteType:"CodeshareConnection",kind:"LinkedField",name:"codesharesCreated",plural:!1,selections:[{alias:null,args:null,concreteType:"CodeshareConnectionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"Codeshare",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:"codesharesCreated(first:1)"},{args:null,kind:"FragmentSpread",name:"RegisterForm_me"}],storageKey:null}],type:"Viewer",abstractKey:null,hash:"70b2d4b9e3099cf6b0efe7349dd1fdf0"};var m=d;const f={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"RegisterPage_codeshare",selections:[{args:null,kind:"FragmentSpread",name:"RegisterForm_codeshare"}],type:"Codeshare",abstractKey:null,hash:"5406411c4be89c0d90e1b03e7c9b9359"};var g=f,p=r(22578),y=r(67294),h=r(14559),v=r(46359),w=r(11436),k=r(7739),b=r(30924),x=r(42195),Z=r.n(x),F=r(6492),j=r(11163),C=r(85893);function P(e){var n,r,t;(0,y.useEffect)((()=>b.Z.page()),[]);const a=(0,l.useRelayEnvironment)(),i=e.codeshare&&(0,l.useFragment)(g,e.codeshare),s=(0,l.useFragment)(m,e.viewer),o=(0,y.useState)(s)[0].me,u=(0,j.useRouter)(),c=u.query.saveCodeshare,d=(null===o||void 0===o||null===(n=o.codesharesCreated)||void 0===n?void 0:n.edges)&&(null===o||void 0===o||null===(r=o.codesharesCreated)||void 0===r?void 0:r.edges[0]),f=null===(t=u.asPath)||void 0===t?void 0:t.match(/^[^?]+(\?.*)$/),x=f&&f[1]||"";return(0,C.jsxs)("div",{id:"register",children:[(0,C.jsx)(h.Z,{children:(0,C.jsx)("title",{children:"Sign up - Codeshare"})}),(0,C.jsx)(w.Z,{}),(0,C.jsx)("main",{children:o.anonymous?(0,C.jsxs)("div",{className:"container",children:[(0,C.jsx)("h1",{className:"is-title",children:"Sign up to save code"}),(0,C.jsxs)("div",{className:"login-form-container",children:[(0,C.jsx)(k.Z,{me:o,codeshare:i,onSuccess:e=>{b.Z.track("Register",{});const n=e.register.viewer.me;return b.Z.identify(n.id,{anonymous:n.anonymous,name:n.name,email:n.email}),c?(0,p.commitMutation)(a,{mutation:F.Z,variables:{input:{id:Z().encodeRelayId("Codeshare",Array.isArray(c)?c[0]:c),save:!0}},onError(){window.location.href="/".concat(c)},onCompleted(){window.location.href="/".concat(c)}}):e.register.viewer.me.codesharesCreated.edges.length?u.push("/codes"):u.push("/new"),new Promise((()=>{}))}}),(0,C.jsxs)("p",{className:"aligncenter",children:["Already signed up?"," ",(0,C.jsx)(v.Z,{href:"/login".concat(x),children:"Log in here"}),"."]})]})]}):(0,C.jsxs)("div",{className:"container",children:[(0,C.jsx)("h1",{className:"is-title",children:"You're already logged in"}),(0,C.jsx)("div",{className:"login-form-container",children:(0,C.jsxs)("p",{children:[(0,C.jsx)(v.Z,{href:"/logout",rel:"nofollow",children:"Logout"})," to create a new account or ",d?(0,C.jsx)(v.Z,{href:"/codes",children:"visit your codeshares"}):(0,C.jsx)(v.Z,{href:"/new",rel:"nofollow",children:"create a codeshare"}),"."]})})]})})]})}var S=r(73496),E=r(34555);const K=e=>{let n=e.apiHeaders,r=e.queryProps,t=e.queryRecords;c.Z.assert(r,"relay fetch failed",{apiHeaders:n,queryProps:r,queryRecords:t});const a=(0,S.Z)({apiHeaders:n,records:t}),i=r.viewer;return E.Z&&i.me.email&&b.Z.identify(i.me.id,{anonymous:i.me.anonymous,name:i.me.name,email:i.me.email}),(0,C.jsx)(l.RelayEnvironmentProvider,{environment:a,children:(0,C.jsx)(P,{viewer:i})})};K.getInitialProps=function(){var e=(0,t.Z)(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.Z)(n,o,{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();var T=K},38631:function(e,n,r){"use strict";var t=r(15861),a=(r(39714),r(83753),r(87757)),i=r.n(a),s=r(55568),o=r(50559),l=r(73496),u=r(67912),c=r(84511),d=r(92432),m=r(3746);function f(e,n,r,t){return g.apply(this,arguments)}function g(){return(g=(0,t.Z)(i().mark((function e(n,r,t,a){var g,h,v,w,k,b,x,Z,F,j;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.H)({req:n.req,res:n.res,logger:d.Z,forceNewSession:a});case 2:return g=e.sent,h=g.apiHeaders,v=g.environment,e.prev=5,e.next=8,(0,s.Z)((()=>{try{return(0,u.fetchQuery)(v,r,t).toPromise()}catch(x){const n=(0,c.Z)(x);if(p(n)||y(n))throw s.V.wrap(x,"non-retryable");throw x}}),i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.Z.debug("fetchQuery retry 1"),e.next=3,0;case 3:return d.Z.debug("fetchQuery retry 2"),e.next=6,100;case 6:return d.Z.debug("fetchQuery retry 3"),e.next=9,200;case 9:case"end":return e.stop()}}),e)})));case 8:w=e.sent,e.next=22;break;case 11:if(e.prev=11,e.t0=e.catch(5),k=(0,c.Z)(e.t0),b=null===k||void 0===k?void 0:k.status,!p(k)||a){e.next=18;break}return d.Z.debug("authentication error, retrying with new session",{status:b,apiErr:k}),e.abrupt("return",f(n,r,t,!0));case 18:throw x=new o.Z("fetchQuery error",{query:r.toString(),vars:t}).wrap(e.t0),(Z=(0,c.Z)(e.t0))&&(p(Z)||y(Z))?"current"in Z&&Z.current%(null!==(F=Z.limit)&&void 0!==F?F:100)!==0||d.Z.warn("fetch query error warning",{message:null===Z||void 0===Z?void 0:Z.message}):/FetchError:/.test(null===e.t0||void 0===e.t0?void 0:e.t0.message)?d.Z.error("fetch query network error",{originalErr:e.t0}):d.Z.error("fetch query error",{err:x,originalErr:e.t0,apiErr:Z}),x;case 22:return j=v.getStore().getSource().toJSON(),e.abrupt("return",{apiHeaders:h,queryProps:w,queryRecords:j,userAgent:(0,m.Z)(n)});case 24:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}function p(e){var n;return 401===(null===e||void 0===e?void 0:e.status)||"UNAUTHENTICATED"===(null===e||void 0===e||null===(n=e.extensions)||void 0===n?void 0:n.code)}function y(e){var n,r;return 429===(null===e||void 0===e?void 0:e.status)||/rate limit/.test(null!==(n=null!==(r=null===e||void 0===e?void 0:e.stack)&&void 0!==r?r:null===e||void 0===e?void 0:e.message)&&void 0!==n?n:"")}n.Z=f},3746:function(e,n,r){"use strict";function t(e){let n=e.req;return n?n.headers["user-agent"]||"Unknown":navigator.userAgent}r.d(n,{Z:function(){return t}})},55568:function(e,n,r){"use strict";r.d(n,{V:function(){return u},Z:function(){return c}});var t=r(15861),a=r(87757),i=r.n(a),s=r(50559),o=r(19920),l=r.n(o);class u extends s.Z{}function c(e,n){return d.apply(this,arguments)}function d(){return(d=(0,t.Z)(i().mark((function e(n,r){var t,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!(e.t0 instanceof u)){e.next=10;break}throw e.t0.source;case 10:if(t=r(),!(a=t.next()).done){e.next=14;break}throw e.t0;case 14:return e.next=16,l()(a.value);case 16:return e.next=18,c(n,(()=>t));case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}},72072:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/register",function(){return r(91089)}])},19920:function(e,n,r){var t=r(15845);e.exports=function(e){var n,r=new t((function(r){n=setTimeout(r,e||0)}));return r.clear=function(){return clearTimeout(n)},r}},98152:function(e,n,r){"use strict";function t(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,a,i=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);s=!0);}catch(l){o=!0,a=l}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return i}}(e,n)||function(e,n){if(e){if("string"===typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.d(n,{Z:function(){return a}})}},function(e){e.O(0,[774,365,607,104,578,366,698,888,179],(function(){return n=72072,e(e.s=n);var n}));var n=e.O();_N_E=n}]);